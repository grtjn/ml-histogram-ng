!function(){"use strict";angular.module("ml.histogram",["highcharts-ng","ml.histogram.tpls"])}(),function(){"use strict";function t(){return{restrict:"E",controller:"HistogramController",controllerAs:"ctrl",replace:!0,scope:{facets:"=",toggle:"&",title:"@",type:"@",colors:"=",legend:"@"},templateUrl:"/ml-histogram-ng/ml-histogram.html"}}function e(t,e){var a=this;a.toggleFacet=function(e,a){t.toggle({facet:e,value:a})},t.$watch("facets",function(t){a.updateChart(t)}),a.histogram={options:{chart:{type:t.type||"column",zoomType:"x",marginTop:40,events:{selection:function(t){if(t.xAxis){var e=t.xAxis[0].min,r=t.xAxis[0].max;t.xAxis[0].axis.categories&&(e=t.xAxis[0].axis.categories[Math.round(e)],r=t.xAxis[0].axis.categories[Math.round(r)]);var i=a.histogram.series.filter(function(t){return t.hasYear}).length>0,s=a.histogram.series.filter(function(t){return t.hasYearMonth}).length>0;i?a.toggleFacet(a.histogram.series[0].name,e+"-"+r):s?(e=new Date(e).toISOString().substr(0,7),r=new Date(r).toISOString().substr(0,7),a.toggleFacet(a.histogram.series[0].name,e+"-"+r)):(e=new Date(e).toISOString().substr(0,10),r=new Date(r).toISOString().substr(0,10),a.toggleFacet(a.histogram.series[0].name,e+"-"+r))}return!1}}},legend:{enabled:t.legend+""=="true"},colors:t.colors||["black","#337ab7"],plotOptions:{line:{dataLabels:{enabled:!1,format:"{y}"}},series:{cursor:"pointer",point:{events:{click:function(t){var e=this.series.name,r=a.histogram.series.filter(function(t){return t.name===e})[0],i=this.category||this.x;(i+"").match(/^[≤≥]/)&&(i=+(i+"").substr(1)),r.hasYear?a.toggleFacet(e,i):r.hasYearMonth?a.toggleFacet(e,new Date(i).toISOString().substr(0,7)):a.toggleFacet(e,new Date(i).toISOString().substr(0,10))}}}}},tooltip:{shared:!0,crosshairs:!0,headerFormat:"<b>{point.key}</b><br/>",pointFormat:"{series.name}: <b>{point.y:.0f}</b><br/>"}},series:[],title:{text:t.title||"Histogram"},xAxis:{type:"datetime",title:{text:"Date"},labels:{},dateTimeLabelFormats:{day:"%e %b",week:"%e %b",month:"%b '%y",year:"%Y"}},yAxis:[{title:{text:"Frequency"}},{linkedTo:0,opposite:!0,title:{text:null}}]},a.updateChart=function(t){function r(){var t=a.histogram.getHighcharts&&a.histogram.getHighcharts();t?(t.xAxis[0].type=a.histogram.xAxis.type,t.xAxis[0].isDirty=!0,"datetime"===a.histogram.xAxis.type?t.xAxis[0].isDatetimeAxis=!0:t.xAxis[0].isDatetimeAxis=!1,o?t.xAxis[0].categories=a.histogram.xAxis.categories:delete t.xAxis[0].categories,t.redraw()):console.log("Histogram chart not initialized. Is Highcharts enabled?")}if(t){var i=[],s=[],o=!1,n=!1,l={};if(angular.forEach(t,function(t,e){var a=!1,r=!1;angular.forEach(t.facetValues,function(t,e){t.value.match(/^[≤≥]?\d\d\d\d$/)?a=o=!0:t.value.match(/^\d\d\d\d-\d\d$/)&&(r=n=!0)}),l[e]={hasYear:a,hasYearMonth:r}}),t=angular.copy(t),angular.forEach(t,function(t,e){var a={},r=[];if(o)l[e].hasYear||(l[e].hasYearMonth?angular.forEach(t.facetValues,function(t,e){var r=t.value.substring(0,4);a[r]=(a[r]||0)+t.count}):angular.forEach(t.facetValues,function(t,e){var r=t.value.substring(0,4);a[r]=(a[r]||0)+t.count}));else if(n){if(l[e].hasYear)throw"ml-histogram-ng execution error";l[e].hasYearMonth||angular.forEach(t.facetValues,function(t,e){var r=t.value.substring(0,7);a[r]=(a[r]||0)+t.count})}Object.keys(a).length>0&&(angular.forEach(a,function(t,e){r.push({name:e,count:t,value:e})}),t.facetValues=r)}),angular.forEach(t,function(t,e){var a=[];angular.forEach(t.facetValues,function(t,e){var r,i=t.value;o?(i.match(/^[≤≥]/)&&(r=s.indexOf(i.substr(1)),r>=0&&(s[r]=i)),r=s.indexOf(i),0>r&&(r=s.indexOf("≤"+i),0>r&&(r=s.indexOf("≥"+i),0>r&&(r=s.length,s.push(i)))),i=r):i=n?new Date(t.value+"-01").getTime():new Date(t.value).getTime(),a.push([i,t.count])}),i.push({name:e,data:a,hasYear:o,hasYearMonth:n})}),o){var c=s.slice().sort(function(t,e){return t=Number((t+"").replace(/[≤≥]/,"")),e=Number((e+"").replace(/[≤≥]/,"")),t-e});angular.forEach(i,function(t,e){angular.forEach(t.data,function(t,e){var a=t[0],r=c.indexOf(s[a]);t[0]=r})}),a.histogram.xAxis.categories=c}else delete a.histogram.xAxis.categories;o?(a.histogram.xAxis.isDirty="category"!==a.histogram.xAxis.type,a.histogram.xAxis.type="category"):(a.histogram.xAxis.isDirty="datetime"!==a.histogram.xAxis.type,a.histogram.xAxis.type="datetime"),a.histogram.series=i,e(r,0)}}}angular.module("ml.histogram").directive("mlHistogram",t).controller("HistogramController",e),e.$inject=["$scope","$timeout"]}(),function(t){try{t=angular.module("ml.histogram.tpls")}catch(e){t=angular.module("ml.histogram.tpls",[])}t.run(["$templateCache",function(t){t.put("/ml-histogram-ng/ml-histogram.html",'<div class="ml-histogram-ng">\n  <highchart config="ctrl.histogram"></highchart>\n</div>')}])}();