!function(){"use strict";angular.module("ml.histogram",["highcharts-ng","ml.histogram.tpls"])}(),function(){"use strict";function t(){return{restrict:"E",controller:"HistogramController",controllerAs:"ctrl",replace:!0,scope:{facets:"=",toggle:"&",title:"@",type:"@",colors:"=",legend:"@"},templateUrl:"/ml-histogram-ng/ml-histogram.html"}}function e(t,e){var a=this;a.toggleFacet=function(e,a){t.toggle({facet:e,value:a})},t.$watch("facets",function(t){a.updateChart(t)}),a.histogram={options:{chart:{type:t.type||"column",zoomType:"x",marginTop:40,events:{selection:function(t){if(t.xAxis){var e=t.xAxis[0].min,r=t.xAxis[0].max;t.xAxis[0].axis.categories&&(e=t.xAxis[0].axis.categories[Math.round(e)],r=t.xAxis[0].axis.categories[Math.round(r)]);var i=a.histogram.series.filter(function(t){return t.hasYear}).length>0,s=a.histogram.series.filter(function(t){return t.hasYearMonth}).length>0;i?a.toggleFacet("Period",e+"-"+r):s?(e=new Date(e).toISOString().substr(0,7),r=new Date(r).toISOString().substr(0,7),a.toggleFacet("Period",e+"-"+r)):(e=new Date(e).toISOString().substr(0,10),r=new Date(r).toISOString().substr(0,10),a.toggleFacet("Period",e+"-"+r))}return!1}}},legend:{enabled:t.legend+""=="true"},colors:t.colors||["black","#337ab7"],plotOptions:{line:{dataLabels:{enabled:!1,format:"{y}"}},series:{cursor:"pointer",point:{events:{click:function(t){var e=this.series.name,r=a.histogram.series.filter(function(t){return t.name===e})[0],i=this.category||this.x;(i+"").match(/^[≤≥]/)&&(i=+(i+"").substr(1)),r.hasYear?a.toggleFacet("Period",i):r.hasYearMonth?a.toggleFacet("Period",new Date(i).toISOString().substr(0,7)):a.toggleFacet("Period",new Date(i).toISOString().substr(0,10))}}}}},tooltip:{shared:!0,crosshairs:!0,headerFormat:"<b>{point.key}</b><br/>",pointFormat:"{series.name}: <b>{point.y:.0f}</b><br/>"}},series:[],title:{text:t.title||"Histogram"},xAxis:{title:{text:"Date"},labels:{},dateTimeLabelFormats:{day:"%e %b",week:"%e %b",month:"%b '%y",year:"%Y"}},yAxis:[{title:{text:"Frequency"}},{linkedTo:0,opposite:!0,title:{text:null}}]},a.updateChart=function(t){function r(){var t=a.histogram.getHighcharts&&a.histogram.getHighcharts();t?(t.xAxis[0].type=a.histogram.xAxis.type,t.xAxis[0].isDirty=!0,o||delete t.xAxis[0].categories,t.redraw()):console.log("Histogram chart not initialized. Is Highcharts enabled?")}if(t){var i=[],s=[],o=!1,n=!1;if(angular.forEach(t,function(t,e){var a=[],r=!1,l=!1;angular.forEach(t.facetValues,function(t,e){var i,g=t.value;g.match(/^[≤≥]/)&&(i=s.indexOf(g.substr(1)),i>=0&&(s[i]=g)),i=s.indexOf(g),0>i&&(i=s.indexOf("≤"+g),0>i&&(i=s.indexOf("≥"+g),0>i&&(i=s.length,s.push(g)))),g.match(/^[≤≥]\d\d\d\d$/)?(r=o=!0,g=i):t.value.match(/^\d\d\d\d$/)?(r=o=!0,g=i):t.value.match(/^\d\d\d\d-\d\d$/)?(l=n=!0,g=new Date(t.value+"-01")):g=new Date(t.value),a.push([g,t.count])}),i.push({name:e,data:a,hasYear:r,hasYearMonth:l})}),o?(a.histogram.xAxis.isDirty="number"!==a.histogram.xAxis.type,a.histogram.xAxis.type="number",angular.forEach(i,function(t,e){angular.forEach(t.data,function(e,a){if(angular.isDate(e[0])){var r=e[0].getFullYear(),i=s.indexOf(r);0>i&&(i=s.indexOf("≤"+r),0>i&&(i=s.indexOf("≥"+r),0>i&&(i=s.length,s.push(r)))),t.data[a]=[i,e[1]]}})})):(a.histogram.xAxis.isDirty="datetime"!==a.histogram.xAxis.type,a.histogram.xAxis.type="datetime",angular.forEach(i,function(t,e){angular.forEach(t.data,function(e,a){angular.isDate(e[0])&&(t.data[a]=[e[0].getTime(),e[1]])})})),o){var l=s.slice().sort(function(t,e){return t=Number((t+"").replace(/[≤≥]/,"")),e=Number((e+"").replace(/[≤≥]/,"")),t-e});angular.forEach(i,function(t,e){angular.forEach(t.data,function(t,e){var a=t[0],r=l.indexOf(s[a]);t[0]=r})}),a.histogram.xAxis.categories=l}else delete a.histogram.xAxis.categories;a.histogram.series=i,e(r,0)}}}angular.module("ml.histogram").directive("mlHistogram",t).controller("HistogramController",e),e.$inject=["$scope","$timeout"]}(),function(t){try{t=angular.module("ml.histogram.tpls")}catch(e){t=angular.module("ml.histogram.tpls",[])}t.run(["$templateCache",function(t){t.put("/ml-histogram-ng/ml-histogram.html",'<div class="ml-histogram-ng">\n  <highchart config="ctrl.histogram"></highchart>\n</div>')}])}();